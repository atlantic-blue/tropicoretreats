---
phase: 02-frontend-integration
plan: 02
type: execute
wave: 2
depends_on: ["02-01"]
files_modified:
  - frontend/src/pages/ContactPage.tsx
autonomous: false

must_haves:
  truths:
    - "User can fill out contact form fields"
    - "User clicks submit and sees loading state (spinner + 'Sending...')"
    - "User sees success toast after successful submission"
    - "User sees error toast with retry button if submission fails"
    - "Form fields are cleared after successful submission"
    - "Form fields are preserved on error (user doesn't lose input)"
    - "Submit button is disabled during submission (no double-submit)"
  artifacts:
    - path: "frontend/src/pages/ContactPage.tsx"
      provides: "Contact form with API integration and user feedback"
      min_lines: 350
  key_links:
    - from: "frontend/src/pages/ContactPage.tsx"
      to: "frontend/src/api/submitContact.ts"
      via: "import and async call"
      pattern: "import.*submitContact.*from"
    - from: "frontend/src/pages/ContactPage.tsx"
      to: "frontend/src/components/Toast.tsx"
      via: "useToast hook"
      pattern: "useToast\\(\\)"
    - from: "frontend/src/pages/ContactPage.tsx"
      to: "frontend/src/types/contact.ts"
      via: "import types"
      pattern: "import.*ContactFormData.*from"
---

<objective>
Wire contact form to API and implement user feedback states.

Purpose: Complete the frontend integration by converting the existing uncontrolled form to a controlled form that submits to the backend API and provides loading, success, and error feedback via the toast component.

Output: Fully functional contact form that submits leads to the API with proper UX feedback, followed by user verification of the complete flow.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-frontend-integration/02-CONTEXT.md
@.planning/phases/02-frontend-integration/02-RESEARCH.md
@.planning/phases/02-frontend-integration/02-01-SUMMARY.md

# Files from Plan 01 (types, API service, toast)
@frontend/src/types/contact.ts
@frontend/src/api/submitContact.ts
@frontend/src/components/Toast.tsx

# File to modify
@frontend/src/pages/ContactPage.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Convert ContactPage to controlled form with API integration</name>
  <files>frontend/src/pages/ContactPage.tsx</files>
  <action>
Modify ContactPage.tsx to implement controlled form state and API submission.

**Key changes:**

1. **Add imports:**
```typescript
import { useState } from 'react';
import { Loader2 } from 'lucide-react';  // Add to existing lucide-react import
import { useToast } from '../components/Toast';
import { submitContact } from '../api/submitContact';
import { ContactFormData, initialFormData, SubmissionState } from '../types/contact';
```

2. **Add state inside component:**
```typescript
const ContactPage: React.FC = () => {
  const { showToast } = useToast();
  const [formData, setFormData] = useState<ContactFormData>(initialFormData);
  const [submissionState, setSubmissionState] = useState<SubmissionState>('idle');

  // Generic change handler for all form fields
  const handleChange = (
    e: React.ChangeEvent<HTMLInputElement | HTMLTextAreaElement | HTMLSelectElement>
  ) => {
    const { name, value } = e.target;
    setFormData(prev => ({ ...prev, [name]: value }));
  };

  // Form submission handler
  const handleSubmit = async (e: React.FormEvent<HTMLFormElement>) => {
    e.preventDefault();

    if (submissionState === 'submitting') return; // Prevent double-submit

    setSubmissionState('submitting');

    const result = await submitContact(formData);

    if (result.success) {
      setSubmissionState('success');
      setFormData(initialFormData); // Clear form
      showToast('success', "Thanks! We'll be in touch soon.");
    } else {
      setSubmissionState('error');
      showToast(
        'error',
        'Oops! Something went wrong.',
        result.message,
        () => handleSubmit(e) // Retry callback
      );
    }
  };

  const isSubmitting = submissionState === 'submitting';

  return (
    // ... existing JSX
  );
};
```

3. **Update form element:**
```tsx
<form className="mt-8 space-y-5" onSubmit={handleSubmit}>
```

4. **Wrap form fields in fieldset with disabled state:**
```tsx
<form className="mt-8 space-y-5" onSubmit={handleSubmit}>
  <fieldset disabled={isSubmitting} className="space-y-5">
    {/* All existing form fields go here */}
  </fieldset>
  {/* Submit button outside fieldset so it can show loading state */}
</form>
```

5. **Convert each input to controlled with value and onChange:**

For text inputs (firstName, lastName, email, phone, company, preferredDates):
```tsx
<input
  type="text"
  id="firstName"
  name="firstName"
  required
  value={formData.firstName}
  onChange={handleChange}
  className="..."
  placeholder="John"
/>
```

For select elements (groupSize, destination):
```tsx
<select
  id="groupSize"
  name="groupSize"
  value={formData.groupSize}
  onChange={handleChange}
  className="..."
>
```

For textarea (message):
```tsx
<textarea
  id="message"
  name="message"
  rows={4}
  required
  value={formData.message}
  onChange={handleChange}
  className="..."
  placeholder="..."
/>
```

6. **Update submit button with loading state:**
```tsx
<button
  type="submit"
  disabled={isSubmitting}
  className="flex w-full items-center justify-center gap-2 rounded-full bg-[#C9A227] px-8 py-4 text-sm font-bold uppercase tracking-widest text-white shadow-lg shadow-[#C9A227]/30 transition-all duration-300 hover:bg-[#B8860B] hover:shadow-xl hover:-translate-y-0.5 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[#C9A227] focus-visible:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:translate-y-0"
>
  {isSubmitting ? (
    <>
      <Loader2 className="h-4 w-4 animate-spin" />
      Sending...
    </>
  ) : (
    <>
      <Send className="h-4 w-4" />
      Send Enquiry
    </>
  )}
</button>
```

**Important styling notes:**
- Keep all existing Tailwind classes on inputs
- Add `disabled:opacity-60 disabled:cursor-not-allowed` to input/select/textarea base classes for visual feedback when form is disabled
- The submit button already has disabled styles from above

**Preserve existing structure:**
- Keep all existing SEO, hero section, contact info, WhatsApp CTA
- Only modify the form section
  </action>
  <verify>
Run TypeScript compilation check:
```bash
cd frontend && npx tsc --noEmit src/pages/ContactPage.tsx
```
Expect: No type errors

Run build:
```bash
cd frontend && npm run build
```
Expect: Build succeeds
  </verify>
  <done>
ContactPage.tsx updated with:
- Controlled form state using useState
- handleChange for all inputs
- handleSubmit with API call via submitContact
- Loading state with spinner and "Sending..." text
- Success toast via useToast
- Error toast with retry callback
- Form clears on success, preserves on error
- Submit button disabled during submission
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete contact form integration with API submission and user feedback (loading, success, error states).
  </what-built>
  <how-to-verify>
**Setup:**
1. Start frontend dev server: `cd frontend && npm run dev`
2. Open http://localhost:3000/contact in browser

**Test 1: Loading State**
1. Fill out form with valid data (first name, last name, email, message required)
2. Click "Send Enquiry"
3. Verify: Button shows spinner with "Sending..." text
4. Verify: All form fields are disabled (grayed out)

**Test 2: Success Flow**
1. Wait for submission to complete (should succeed if API is running)
2. Verify: Green toast appears at bottom-center saying "Thanks! We'll be in touch soon."
3. Verify: Form fields are cleared (empty)
4. Verify: Toast auto-dismisses after 5 seconds (or click X to dismiss)

**Test 3: Error Flow (simulate by disconnecting network)**
1. Disconnect from internet (airplane mode or disable WiFi)
2. Fill out form and submit
3. Verify: Red toast appears at bottom-center with error message
4. Verify: Toast has "Try Again" button
5. Verify: Form fields are PRESERVED (not cleared)
6. Reconnect internet, click "Try Again", verify it resubmits

**Test 4: Double-Submit Prevention**
1. Fill out form, click submit rapidly multiple times
2. Verify: Only one submission occurs (check network tab)

**Visual checks:**
- Toast appears at bottom-center of viewport
- Toast has warm, inviting styling (matches site design)
- Loading spinner animates smoothly
- Form disabled state is visually clear
  </how-to-verify>
  <resume-signal>Type "approved" to confirm all tests pass, or describe any issues found.</resume-signal>
</task>

</tasks>

<verification>
After task completion and checkpoint approval:

1. **Form submits to API:**
```bash
# Check network tab in browser DevTools during submission
# Should see POST to https://u57cra1p8h.execute-api.us-east-1.amazonaws.com/leads
```

2. **Lead appears in DynamoDB (if API deployed):**
```bash
aws dynamodb scan --table-name tropicoretreats-leads-dev --limit 1 | jq '.Items[0]'
```

3. **Build succeeds:**
```bash
cd frontend && npm run build
```
</verification>

<success_criteria>
- [ ] ContactPage.tsx uses controlled form state
- [ ] Form submits to API via submitContact function
- [ ] Loading state shows spinner and "Sending..." text
- [ ] Success shows green bottom-center toast
- [ ] Error shows red bottom-center toast with retry button
- [ ] Form clears after successful submission
- [ ] Form preserves values on error
- [ ] Submit button disabled during submission
- [ ] Human verified all flows work correctly
- [ ] Build succeeds
</success_criteria>

<output>
After completion, create `.planning/phases/02-frontend-integration/02-02-SUMMARY.md`
</output>
