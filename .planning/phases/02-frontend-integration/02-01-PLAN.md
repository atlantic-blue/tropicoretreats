---
phase: 02-frontend-integration
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - frontend/src/types/contact.ts
  - frontend/src/api/submitContact.ts
  - frontend/src/env.ts
  - frontend/.env
  - frontend/src/components/Toast.tsx
autonomous: true

must_haves:
  truths:
    - "API service can POST form data to /leads endpoint"
    - "Toast can appear at bottom-center of viewport"
    - "Toast can show retry button for network errors"
    - "Environment has API_URL configured"
  artifacts:
    - path: "frontend/src/types/contact.ts"
      provides: "TypeScript interfaces for form data and API response"
      exports: ["ContactFormData", "SubmitContactResult"]
    - path: "frontend/src/api/submitContact.ts"
      provides: "API service with 30s timeout handling"
      exports: ["submitContact"]
    - path: "frontend/src/components/Toast.tsx"
      provides: "Bottom-center toast with retry support"
      exports: ["ToastProvider", "useToast"]
  key_links:
    - from: "frontend/src/api/submitContact.ts"
      to: "process.env.API_URL"
      via: "dotenv-webpack"
      pattern: "process\\.env\\.API_URL"
    - from: "frontend/src/api/submitContact.ts"
      to: "frontend/src/types/contact.ts"
      via: "import"
      pattern: "import.*from.*types/contact"
---

<objective>
Create foundation components for contact form API integration.

Purpose: Establish the API service, TypeScript types, toast enhancements, and environment configuration that the contact form will use for submission and feedback.

Output: API service with timeout handling, enhanced toast component, typed interfaces, and environment configuration ready for form integration in Plan 02.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-frontend-integration/02-CONTEXT.md
@.planning/phases/02-frontend-integration/02-RESEARCH.md
@.planning/phases/01-core-api/01-01-SUMMARY.md

# Backend validation schema (must match frontend types)
@backend/src/lib/validation.ts

# Existing frontend files to modify
@frontend/src/env.ts
@frontend/src/components/Toast.tsx
@frontend/.env
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create TypeScript interfaces for contact form</name>
  <files>frontend/src/types/contact.ts</files>
  <action>
Create TypeScript interfaces matching the backend Zod schema in `backend/src/lib/validation.ts`:

```typescript
// frontend/src/types/contact.ts

/**
 * Contact form data matching backend LeadSchema.
 * Required: firstName, lastName, email, message
 * Optional: phone, company, groupSize, preferredDates, destination
 */
export interface ContactFormData {
  firstName: string;
  lastName: string;
  email: string;
  phone: string;
  company: string;
  groupSize: string;
  preferredDates: string;
  destination: string;
  message: string;
}

/**
 * Initial empty form state for reset after successful submission.
 */
export const initialFormData: ContactFormData = {
  firstName: '',
  lastName: '',
  email: '',
  phone: '',
  company: '',
  groupSize: '',
  preferredDates: '',
  destination: '',
  message: '',
};

/**
 * Result from submitContact API call.
 */
export interface SubmitContactResult {
  success: boolean;
  message?: string;
  leadId?: string;
}

/**
 * Form submission state machine states.
 */
export type SubmissionState = 'idle' | 'submitting' | 'success' | 'error';
```

Note: Optional fields in backend schema are represented as empty strings in frontend (not undefined) for controlled input simplicity.
  </action>
  <verify>
Run TypeScript compilation check:
```bash
cd frontend && npx tsc --noEmit src/types/contact.ts
```
Expect: No type errors
  </verify>
  <done>
Types file exists at `frontend/src/types/contact.ts` with ContactFormData, initialFormData, SubmitContactResult, and SubmissionState exports.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create API service with timeout handling</name>
  <files>frontend/src/api/submitContact.ts, frontend/src/env.ts, frontend/.env</files>
  <action>
**Step 1: Update frontend/.env to add API_URL**

Add to existing `.env` file (do NOT remove existing auth/payments vars):
```
API_URL=https://u57cra1p8h.execute-api.us-east-1.amazonaws.com
```

**Step 2: Update frontend/src/env.ts to expose API_URL**

Add api section to the Env interface and createEnv function:

```typescript
interface Env {
  auth: {
    // ... existing
  };
  payments: {
    // ... existing
  };
  api: {
    contactUrl: string;
  };
}

const createEnv = (): Env => {
  // ... existing auth and payments

  return {
    auth: { /* existing */ },
    payments: { /* existing */ },
    api: {
      contactUrl: process.env.API_URL || '',
    },
  };
};
```

**Step 3: Create frontend/src/api/submitContact.ts**

Create directory `frontend/src/api/` if it doesn't exist, then create:

```typescript
import env from '../env';
import { ContactFormData, SubmitContactResult } from '../types/contact';

const TIMEOUT_MS = 30000; // 30 seconds per design decision

/**
 * Submit contact form data to the leads API.
 * Handles timeout (30s), network errors, and API errors.
 * Returns structured result for UI feedback.
 */
export async function submitContact(data: ContactFormData): Promise<SubmitContactResult> {
  const controller = new AbortController();
  const timeoutId = setTimeout(() => controller.abort(), TIMEOUT_MS);

  try {
    const response = await fetch(`${env.api.contactUrl}/leads`, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify(data),
      signal: controller.signal,
    });

    clearTimeout(timeoutId);

    if (!response.ok) {
      const errorData = await response.json().catch(() => ({}));
      return {
        success: false,
        message: errorData.message || 'Something went wrong. Please try again.',
      };
    }

    const result = await response.json();
    return {
      success: true,
      leadId: result.leadId,
    };
  } catch (error) {
    clearTimeout(timeoutId);

    if (error instanceof Error) {
      if (error.name === 'AbortError') {
        return {
          success: false,
          message: 'Request timed out. Please check your connection and try again.',
        };
      }
    }

    // Network error (TypeError) or other unexpected error
    return {
      success: false,
      message: 'Unable to connect. Please check your internet and try again.',
    };
  }
}
```

Use `env.api.contactUrl` (not `process.env.API_URL` directly) for consistency with existing env pattern.
  </action>
  <verify>
Run TypeScript compilation check:
```bash
cd frontend && npx tsc --noEmit src/api/submitContact.ts
```
Expect: No type errors

Verify .env has API_URL:
```bash
grep API_URL frontend/.env
```
Expect: Line containing `API_URL=https://...`
  </verify>
  <done>
- `frontend/.env` contains `API_URL=https://u57cra1p8h.execute-api.us-east-1.amazonaws.com`
- `frontend/src/env.ts` exports `api.contactUrl`
- `frontend/src/api/submitContact.ts` exports async `submitContact` function with 30s timeout
  </done>
</task>

<task type="auto">
  <name>Task 3: Enhance Toast component for bottom-center and retry support</name>
  <files>frontend/src/components/Toast.tsx</files>
  <action>
Modify existing Toast.tsx to support:
1. Bottom-center positioning (new default for this use case)
2. Optional retry callback for error toasts
3. Slide-in-from-bottom animation for bottom-center toasts

**Changes to make:**

1. **Update Toast interface** to add optional `onRetry` callback:
```typescript
interface Toast {
  id: string;
  type: ToastType;
  title: string;
  message?: string;
  onRetry?: () => void;  // NEW: retry callback for network errors
}
```

2. **Update ToastContextType** to accept `onRetry` parameter:
```typescript
interface ToastContextType {
  showToast: (type: ToastType, title: string, message?: string, onRetry?: () => void) => void;
}
```

3. **Update showToast callback** to pass onRetry to toast object:
```typescript
const showToast = useCallback((type: ToastType, title: string, message?: string, onRetry?: () => void) => {
  const id = Math.random().toString(36).substring(2, 9);
  setToasts(prev => [...prev, { id, type, title, message, onRetry }]);
  // ... rest unchanged
}, []);
```

4. **Change toast container position** from `right-4 top-24` to `bottom-6 left-1/2 -translate-x-1/2`:
```typescript
<div className="fixed bottom-6 left-1/2 z-[100] flex -translate-x-1/2 flex-col gap-3">
```

5. **Update animation** from `slide-in-from-right` to `slide-in-from-bottom`:
```typescript
className={`flex w-80 items-start gap-3 rounded-xl border p-4 shadow-lg animate-in slide-in-from-bottom duration-300 ${getStyles(toast.type)}`}
```

6. **Add retry button** when `onRetry` is provided (inside the flex-1 div, after message):
```typescript
{toast.message && <p className="mt-1 text-sm text-gray-600">{toast.message}</p>}
{toast.onRetry && (
  <button
    onClick={() => {
      removeToast(toast.id);
      toast.onRetry?.();
    }}
    className="mt-2 text-sm font-semibold text-red-700 hover:text-red-800 transition-colors"
  >
    Try Again
  </button>
)}
```

The warm, inviting feel is maintained by keeping the existing emerald/red/blue color palette from the design system.
  </action>
  <verify>
Run TypeScript compilation check:
```bash
cd frontend && npx tsc --noEmit src/components/Toast.tsx
```
Expect: No type errors

Visual check: Run dev server and manually test toast in browser (will be verified in Plan 02 checkpoint)
  </verify>
  <done>
Toast component updated with:
- `onRetry` callback support in Toast interface
- `showToast` accepts optional 4th parameter for retry
- Container positioned at bottom-center with slide-in-from-bottom animation
- Retry button renders when `onRetry` provided
  </done>
</task>

</tasks>

<verification>
After all tasks complete:

1. **TypeScript compilation passes:**
```bash
cd frontend && npm run build 2>&1 | head -20
```
Expect: Build succeeds without type errors

2. **All new files exist:**
```bash
ls -la frontend/src/types/contact.ts frontend/src/api/submitContact.ts
```

3. **Environment configured:**
```bash
grep -q "API_URL" frontend/.env && echo "API_URL present"
grep -q "contactUrl" frontend/src/env.ts && echo "contactUrl in env.ts"
```
</verification>

<success_criteria>
- [ ] `frontend/src/types/contact.ts` exists with ContactFormData, SubmitContactResult, SubmissionState types
- [ ] `frontend/src/api/submitContact.ts` exists with submitContact function
- [ ] `frontend/src/env.ts` updated with api.contactUrl
- [ ] `frontend/.env` contains API_URL
- [ ] `frontend/src/components/Toast.tsx` supports bottom-center positioning and onRetry callback
- [ ] TypeScript compilation passes (no type errors)
- [ ] Build succeeds
</success_criteria>

<output>
After completion, create `.planning/phases/02-frontend-integration/02-01-SUMMARY.md`
</output>
